<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Puzzle</title>
    
    <!-- Include jQuery (Fixes Missing jQuery Issues) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="/css/puzzle.css">
</head>

<body>

    <div id="container">
        <a href="#" class="button start">Start</a>
        <div class="box"></div>
        <div align="center">
            <a href="#" class="button reset">Reset</a>
        </div>
    </div>

    <div class="cover">
        <div class="score">
            <p id="scr_head">ðŸŽ‰ Puzzle Solved ðŸŽ‰</p>
            <p id="scr_time">Time: <span id="min">00</span> Min <span id="sec">00</span> Sec</p>
            <p id="scr_moves">Moves: <span id="moves">0</span></p>
            <div class="button OK">OK</div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            var box = $(".box"),
                original = [...Array(9).keys()], // 3x3 puzzle
                shuffled = [],
                moves = 0,
                startTime,
                images = ["https://preview.ibb.co/kMdsfm/kfp.png"];

            function initPuzzle() {
                shuffled = [...original];
                shuffleArray(shuffled);
                renderPuzzle();
                moves = 0;
                $(".cover").hide();
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function renderPuzzle() {
                box.empty();
                shuffled.forEach((num, index) => {
                    let tile = $("<div>")
                        .addClass("tile")
                        .attr("data-index", index)
                        .css({
                            "background-image": "url(" + images[0] + ")",
                            "background-position": `${(num % 3) * -100}px ${(Math.floor(num / 3)) * -100}px`
                        })
                        .click(function () {
                            moveTile(index);
                        });
                    box.append(tile);
                });
            }

            function moveTile(index) {
                let emptyIndex = shuffled.indexOf(8);
                let validMoves = [
                    emptyIndex - 3, emptyIndex + 3, // Up / Down
                    emptyIndex - 1, emptyIndex + 1  // Left / Right
                ];

                if (validMoves.includes(index)) {
                    [shuffled[emptyIndex], shuffled[index]] = [shuffled[index], shuffled[emptyIndex]];
                    moves++;
                    renderPuzzle();
                    checkWin();
                }
            }

            function checkWin() {
                if (shuffled.every((val, idx) => val === original[idx])) {
                    let elapsed = Math.floor((new Date() - startTime) / 1000);
                    $("#min").text(Math.floor(elapsed / 60));
                    $("#sec").text(elapsed % 60);
                    $("#moves").text(moves);
                    $(".cover").fadeIn();
                }
            }

            $(".start").click(function () {
                $(this).hide();
                startTime = new Date();
                initPuzzle();
            });

            $(".reset").click(function () {
                $(".start").show();
                initPuzzle();
            });

            $(".OK").click(function () {
                $(".cover").fadeOut();
            });

            initPuzzle();
        });
    </script>

</body>

</html>
